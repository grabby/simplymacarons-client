import"./style-BRF-I4tH.js";import"./cart-DsAptGTX.js";document.addEventListener("DOMContentLoaded",()=>{c(),u(),m(),p()});function c(){if(cart.getTotalQuantity()===0){const t=document.getElementById("cart-items");t&&(t.innerHTML=`
                <div class="text-center py-12">
                    <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m6-5v6a2 2 0 01-2 2H9a2 2 0 01-2-2v-6m8 0V9a2 2 0 00-2-2H9a2 2 0 00-2 2v4.01"></path>
                    </svg>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">Your cart is empty</h3>
                    <p class="text-gray-500 mb-6">Add some delicious macarons to get started!</p>
                    <a href="/#flavors" class="btn-primary">
                        Browse Flavors
                    </a>
                </div>
            `);const r=document.getElementById("submit-order");r&&(r.disabled=!0,r.textContent="Cart is Empty");return}const e=document.getElementById("submit-order");e&&(e.disabled=!1,e.textContent="Place Order")}function u(){const e=document.getElementById("checkout-form");if(!e)return;e.addEventListener("submit",f),e.querySelectorAll("[required]").forEach(r=>{r.addEventListener("input",l),r.addEventListener("blur",l)})}function m(){const e=document.getElementById("pickup"),t=document.getElementById("delivery"),r=document.getElementById("delivery-address-section"),o=document.getElementById("postal_code"),n=document.getElementById("address");!e||!t||!r||(e.addEventListener("change",()=>{r.classList.add("hidden"),o.removeAttribute("required"),n.removeAttribute("required")}),t.addEventListener("change",()=>{r.classList.remove("hidden"),o.setAttribute("required","required"),n.setAttribute("required","required")}),o&&o.addEventListener("input",s=>{const d=s.target.value.toUpperCase();s.target.value=d}))}function p(){const e=document.getElementById("preferred_date");if(!e)return;const t=new Date;t.setDate(t.getDate()+1);const r=t.toISOString().split("T")[0];e.setAttribute("min",r)}function l(e){const t=e.target,r=t.value.trim(),o=t.hasAttribute("required");t.classList.remove("border-red-500");const n=t.parentNode.querySelector(".form-error");return n&&n.remove(),o&&!r?(a(t,"This field is required"),!1):t.type==="email"&&r&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r)?(a(t,"Please enter a valid email address"),!1):t.type==="tel"&&r&&!/^[\+]?[1-9][\d]{0,15}$/.test(r.replace(/\s/g,""))?(a(t,"Please enter a valid phone number"),!1):t.id==="postal_code"&&r&&!/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/.test(r)?(a(t,"Please enter a valid Canadian postal code"),!1):!0}function a(e,t){e.classList.add("border-red-500");const r=document.createElement("div");r.className="form-error",r.textContent=t,e.parentNode.appendChild(r)}function g(){const e=document.getElementById("checkout-form");if(!e)return!1;const t=e.querySelectorAll("[required]");let r=!0;t.forEach(n=>{l({target:n})||(r=!1)}),cart.getTotalQuantity()===0&&(i("Your cart is empty. Please add some macarons before placing an order.","error"),r=!1);const o=document.getElementById("delivery");if(o&&o.checked){const n=document.getElementById("postal_code").value,s=document.getElementById("address").value;(!n||!s)&&(i("Please provide both postal code and address for delivery.","error"),r=!1)}return r}async function f(e){if(e.preventDefault(),!g())return;const t=e.target,r=document.getElementById("submit-order");r.disabled=!0,r.innerHTML=`
        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Processing...
    `;try{const o=new FormData(t);o.set("order_summary",cart.generateOrderSummary()),o.set("order_total",cart.getTotal().toFixed(2)),o.set("order_items",JSON.stringify(Array.from(cart.items.entries()))),cart.setCustomerInfo({name:o.get("name"),email:o.get("email"),phone:o.get("phone"),notes:o.get("notes"),customFlavor:o.get("custom_flavor")}),cart.setDeliveryDetails(o.get("delivery_type"),o.get("address"),o.get("preferred_date"));const n=y(o);if((await fetch("https://formspree.io/f/xblgbezo",{method:"POST",body:o,headers:{Accept:"application/json"}})).ok)cart.clear(),i("Order submitted successfully! Redirecting to your invoice...","success"),setTimeout(()=>{window.location.href=`/invoice.html?id=${n}`},2e3);else throw new Error("Failed to submit order")}catch(o){console.error("Error submitting order:",o),i("There was an error submitting your order. Please try again or contact us directly.","error"),r.disabled=!1,r.textContent="Place Order"}}function i(e,t="info"){document.querySelectorAll(".notification").forEach(d=>d.remove());const o=document.createElement("div");o.className="notification fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm transform transition-all duration-300 translate-x-full";const n=t==="success"?"bg-green-500":t==="error"?"bg-red-500":"bg-blue-500",s=t==="success"?"text-green-100":t==="error"?"text-red-100":"text-blue-100";o.innerHTML=`
        <div class="flex items-center space-x-3">
            <svg class="w-5 h-5 ${s}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                ${t==="success"?'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>':t==="error"?'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>':'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>'}
            </svg>
            <span class="text-white font-medium">${e}</span>
            <button onclick="this.parentElement.parentElement.remove()" class="text-white hover:text-gray-200">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    `,o.classList.add(n),document.body.appendChild(o),setTimeout(()=>{o.classList.remove("translate-x-full")},100),setTimeout(()=>{o.parentElement&&(o.classList.add("translate-x-full"),setTimeout(()=>{o.parentElement&&o.remove()},300))},5e3)}function v(){const e=Date.now().toString(36),t=Math.random().toString(36).substring(2,8);return`INV-${e}-${t}`.toUpperCase()}function h(e){const t=JSON.parse(localStorage.getItem("simplyMacaronsInvoices")||"{}");return t[e.id]={...e,createdAt:new Date().toISOString()},localStorage.setItem("simplyMacaronsInvoices",JSON.stringify(t)),e.id}function y(e){const t=v(),r={id:t,orderNumber:`ORD-${Date.now()}`,customer:{name:e.get("name"),email:e.get("email"),phone:e.get("phone")},items:JSON.parse(e.get("order_items")),subtotal:parseFloat(e.get("order_total")),deliveryType:e.get("delivery_type"),deliveryAddress:e.get("address")||"Pickup",preferredDate:e.get("preferred_date"),notes:e.get("notes"),customFlavor:e.get("custom_flavor"),status:"pending",deliveryFee:null,total:parseFloat(e.get("order_total"))};return h(r),t}window.showNotification=i;
