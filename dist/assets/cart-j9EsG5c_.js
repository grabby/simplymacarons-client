import"./cart-DyeD8E41.js";document.addEventListener("DOMContentLoaded",()=>{u(),m(),f(),p()});function u(){if(cart.getTotalQuantity()===0){const e=document.getElementById("cart-items");e&&(e.innerHTML=`
                <div class="text-center py-12">
                    <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m6-5v6a2 2 0 01-2 2H9a2 2 0 01-2-2v-6m8 0V9a2 2 0 00-2-2H9a2 2 0 00-2 2v4.01"></path>
                    </svg>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">Your cart is empty</h3>
                    <p class="text-gray-500 mb-6">Add some delicious macarons to get started!</p>
                    <a href="/#flavors" class="btn-primary">
                        Browse Flavors
                    </a>
                </div>
            `);const t=document.getElementById("submit-order");t&&(t.disabled=!0,t.textContent="Cart is Empty");return}const o=document.getElementById("submit-order");o&&(o.disabled=!1,o.textContent="Place Order")}function m(){const o=document.getElementById("checkout-form");if(!o)return;o.addEventListener("submit",h),o.querySelectorAll("[required]").forEach(t=>{t.addEventListener("input",c),t.addEventListener("blur",c)})}function f(){const o=document.getElementById("pickup"),e=document.getElementById("delivery"),t=document.getElementById("delivery-address-section"),r=document.getElementById("postal_code"),n=document.getElementById("address");!o||!e||!t||(o.addEventListener("change",()=>{t.classList.add("hidden"),r.removeAttribute("required"),n.removeAttribute("required"),cart.setDeliveryZone(""),cart.updateCartDisplay()}),e.addEventListener("change",()=>{t.classList.remove("hidden"),r.setAttribute("required","required"),n.setAttribute("required","required")}),r&&r.addEventListener("input",s=>{const d=s.target.value.toUpperCase();cart.setDeliveryZone(d);const l=cart.deliveryZone;l&&i(`Delivery to ${l.zone}: $${l.fee.toFixed(2)}`,"info")}))}function p(){const o=document.getElementById("preferred_date");if(!o)return;const e=new Date;e.setDate(e.getDate()+1);const t=e.toISOString().split("T")[0];o.setAttribute("min",t)}function c(o){const e=o.target,t=e.value.trim(),r=e.hasAttribute("required");e.classList.remove("border-red-500");const n=e.parentNode.querySelector(".form-error");return n&&n.remove(),r&&!t?(a(e,"This field is required"),!1):e.type==="email"&&t&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?(a(e,"Please enter a valid email address"),!1):e.type==="tel"&&t&&!/^[\+]?[1-9][\d]{0,15}$/.test(t.replace(/\s/g,""))?(a(e,"Please enter a valid phone number"),!1):e.id==="postal_code"&&t&&!/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/.test(t)?(a(e,"Please enter a valid Canadian postal code"),!1):!0}function a(o,e){o.classList.add("border-red-500");const t=document.createElement("div");t.className="form-error",t.textContent=e,o.parentNode.appendChild(t)}function g(){const o=document.getElementById("checkout-form");if(!o)return!1;const e=o.querySelectorAll("[required]");let t=!0;e.forEach(n=>{c({target:n})||(t=!1)}),cart.getTotalQuantity()===0&&(i("Your cart is empty. Please add some macarons before placing an order.","error"),t=!1);const r=document.getElementById("delivery");if(r&&r.checked){const n=document.getElementById("postal_code").value,s=document.getElementById("address").value;(!n||!s)&&(i("Please provide both postal code and address for delivery.","error"),t=!1),cart.deliveryZone||(i("We don't deliver to that postal code. Please check your location.","error"),t=!1)}return t}async function h(o){if(o.preventDefault(),!g())return;const e=o.target,t=document.getElementById("submit-order");t.disabled=!0,t.innerHTML=`
        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Processing...
    `;try{const r=new FormData(e);if(r.set("order_summary",cart.generateOrderSummary()),r.set("order_total",cart.getTotal().toFixed(2)),r.set("order_items",JSON.stringify(Array.from(cart.items.entries()))),cart.setCustomerInfo({name:r.get("name"),email:r.get("email"),phone:r.get("phone"),notes:r.get("notes"),customFlavor:r.get("custom_flavor")}),cart.setDeliveryDetails(r.get("delivery_type"),r.get("address"),r.get("preferred_date")),(await fetch(e.action,{method:"POST",body:r,headers:{Accept:"application/json"}})).ok)i("Order submitted successfully! We'll contact you soon to confirm your order.","success"),setTimeout(()=>{cart.clear(),window.location.href="/"},3e3);else throw new Error("Failed to submit order")}catch(r){console.error("Error submitting order:",r),i("There was an error submitting your order. Please try again or contact us directly.","error"),t.disabled=!1,t.textContent="Place Order"}}function i(o,e="info"){document.querySelectorAll(".notification").forEach(d=>d.remove());const r=document.createElement("div");r.className="notification fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm transform transition-all duration-300 translate-x-full";const n=e==="success"?"bg-green-500":e==="error"?"bg-red-500":"bg-blue-500",s=e==="success"?"text-green-100":e==="error"?"text-red-100":"text-blue-100";r.innerHTML=`
        <div class="flex items-center space-x-3">
            <svg class="w-5 h-5 ${s}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                ${e==="success"?'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>':e==="error"?'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>':'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>'}
            </svg>
            <span class="text-white font-medium">${o}</span>
            <button onclick="this.parentElement.parentElement.remove()" class="text-white hover:text-gray-200">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    `,r.classList.add(n),document.body.appendChild(r),setTimeout(()=>{r.classList.remove("translate-x-full")},100),setTimeout(()=>{r.parentElement&&(r.classList.add("translate-x-full"),setTimeout(()=>{r.parentElement&&r.remove()},300))},5e3)}window.showNotification=i;
